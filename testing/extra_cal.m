

%% pixel-to-pixel variability

if 1
%     path='/home/kristof/work/GBS/PEARL-GBS/2018/testing_Eureka/testing/';
%     spec=get_spectrum_v2([path '27021815.csv'], '3:49:57 PM');
    
%     path='/home/kristof/work/GBS/UT-GBS/2018/testing_Eureka/testing/';
%     spec=get_spectrum_v2([path '01031814.csv'], '2:54:20 PM');

%     path='/home/kristof/work/GBS/PEARL-GBS/2019/testing_Eureka/csv/';
%     spec=get_spectrum_v2([path '01031920.csv'], '8:26:50 PM');
    
%     spec(1088)=interp1(1087:2:1089,[spec(1087),spec(1089)], 1088);
    
%     spec=[1:2048].^2 + (randn(1,2048)-0.5).*0.01.*[1:2048];

    [smooth_spec]=boxcar(1:2048,spec,2);

    figure
    subplot(211)

    plot(spec)
    xlim([0,2044])

    ylabel('Counts')

    subplot(212)

    plot(spec-smooth_spec), hold on
    xlim([0,2045])

    ylabel('Counts')
    xlabel('CCD Pixel')

end

%% spectral noise
% 
% load('short_exposures.mat')
% 
% 
% rms=[];
% specs=specs_5spec;
% 
% for i=1:size(specs,1)
%     specs(i,:)=specs(i,:)/mean(specs(i,:));
% end
% 
% 
% tmp_mean=mean(specs,1);
% 
% for i=1:size(specs,1)
%     tmp=mean(specs(1:i,:),1);
%     rms(i)=sqrt(mean((tmp./tmp_mean).^2));
% end
% 
% plot(rms), hold on
% % plot([1:length(rms)].^(-0.5),'r--')


% t_1spec={'7:38:13 PM','7:38:15 PM','7:38:16 PM',...
% '7:38:18 PM','7:38:19 PM','7:38:20 PM','7:38:22 PM',...
% '7:38:23 PM','7:38:25 PM','7:38:26 PM','7:38:28 PM',...
% '7:38:29 PM','7:38:31 PM','7:38:32 PM','7:38:33 PM',...
% '7:38:35 PM','7:38:36 PM','7:38:38 PM','7:38:39 PM',...
% '7:38:41 PM','7:38:42 PM','7:38:43 PM','7:38:45 PM',...
% '7:38:46 PM','7:38:48 PM','7:38:49 PM','7:38:51 PM',...
% '7:38:52 PM','7:38:53 PM','7:38:55 PM','7:38:56 PM',...
% '7:38:58 PM','7:38:59 PM','7:39:01 PM','7:39:02 PM',...
% '7:39:04 PM','7:39:05 PM','7:39:06 PM','7:39:08 PM',...
% '7:39:09 PM','7:39:11 PM','7:39:12 PM','7:39:14 PM',...
% '7:39:15 PM','7:39:17 PM','7:39:18 PM','7:39:19 PM',...
% '7:39:21 PM','7:39:22 PM','7:39:24 PM','7:39:25 PM',...
% '7:39:27 PM','7:39:28 PM','7:39:29 PM','7:39:31 PM',...
% '7:39:32 PM','7:39:34 PM','7:39:35 PM','7:39:37 PM',...
% '7:39:38 PM','7:39:39 PM','7:39:41 PM','7:39:42 PM',...
% '7:39:44 PM','7:39:45 PM','7:39:47 PM','7:39:48 PM',...
% '7:39:49 PM','7:39:51 PM','7:39:52 PM','7:39:54 PM',...
% '7:39:55 PM','7:39:57 PM','7:39:58 PM','7:39:59 PM',...
% '7:40:01 PM','7:40:02 PM','7:40:04 PM','7:40:05 PM',...
% '7:40:07 PM','7:40:08 PM','7:40:09 PM','7:40:11 PM',...
% '7:40:12 PM','7:40:14 PM','7:40:15 PM','7:40:17 PM'};
% 
% t_5spec={'7:40:18 PM','7:40:21 PM','7:40:23 PM','7:40:26 PM',...
% '7:40:28 PM','7:40:31 PM','7:40:33 PM','7:40:36 PM',...
% '7:40:38 PM','7:40:41 PM','7:40:43 PM','7:40:46 PM',...
% '7:40:48 PM','7:40:51 PM','7:40:53 PM','7:40:56 PM',...
% '7:40:58 PM','7:41:01 PM','7:41:03 PM','7:41:06 PM',...
% '7:41:08 PM','7:41:11 PM','7:41:13 PM','7:41:16 PM',...
% '7:41:18 PM','7:41:21 PM','7:41:23 PM','7:41:26 PM',...
% '7:41:28 PM','7:41:31 PM','7:41:33 PM','7:41:36 PM',...
% '7:41:38 PM','7:41:41 PM','7:41:43 PM','7:41:46 PM',...
% '7:41:48 PM','7:41:51 PM','7:41:53 PM','7:41:56 PM',...
% '7:41:58 PM','7:42:01 PM','7:42:03 PM','7:42:06 PM',...
% '7:42:08 PM','7:42:11 PM','7:42:13 PM','7:42:16 PM',...
% '7:42:18 PM','7:42:21 PM','7:42:23 PM','7:42:26 PM',...
% '7:42:28 PM','7:42:31 PM','7:42:33 PM','7:42:36 PM',...
% '7:42:38 PM','7:42:41 PM','7:42:43 PM','7:42:46 PM',...
% '7:42:48 PM','7:42:51 PM','7:42:53 PM','7:42:56 PM',...
% '7:42:58 PM','7:43:01 PM','7:43:03 PM','7:43:06 PM',...
% '7:43:08 PM','7:43:11 PM','7:43:13 PM','7:43:15 PM',...
% '7:43:18 PM','7:43:21 PM','7:43:23 PM','7:43:26 PM',...
% '7:43:28 PM','7:43:31 PM','7:43:33 PM','7:43:36 PM',...
% '7:43:38 PM','7:43:41 PM','7:43:43 PM','7:43:46 PM',...
% '7:43:48 PM','7:43:51 PM','7:43:53 PM','7:43:56 PM',...
% '7:43:58 PM','7:44:01 PM','7:44:03 PM','7:44:05 PM',...
% '7:44:08 PM','7:44:11 PM','7:44:13 PM','7:44:16 PM',...
% '7:44:18 PM','7:44:21 PM','7:44:23 PM','7:44:26 PM'};



% specs_1spec=zeros(length(t_1spec),2048);
% specs_5spec=zeros(length(t_5spec),2048);
% 
% for i=1:length(t_1spec)
%     
%     specs_1spec(i,:)=get_spectrum_v2('26021819.csv',t_1spec{i});
%     
% end
% 
% for i=1:length(t_5spec)
%     
%     specs_5spec(i,:)=get_spectrum_v2('26021819.csv',t_5spec{i});
%     
% end


%% detector non-linearity


